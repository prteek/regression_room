<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prateek">
<meta name="dcterms.date" content="2025-11-23">

<title>Miles per gallon – Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Prateek</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/prteek"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Miles per gallon</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">random effects</div>
                <div class="quarto-category">hierarchical models</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Prateek </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 23, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      <p>How much does city fuel economy varies across car manufacturers? Using the <em>mpg</em> dataset, we examine gas, front‑wheel‑drive compact, midsize, and subcompact cars from 1999–2008. We compare manufacturers while adjusting for engine size and model year, and we also account for the fact that each manufacturer offers several models. The key findings are: bigger engines get worse city mileage (intuitive), and once engine size is considered, transmission type and vehicle class have negligible effect. Even after adjusting for engine size and year, typical city mpg still differs by manufacturer by about ±6%, indicating that manufacturers have inherent differences in city fuel economy.</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#eda" id="toc-eda" class="nav-link" data-scroll-target="#eda">EDA</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#baseline-model" id="toc-baseline-model" class="nav-link" data-scroll-target="#baseline-model">Baseline model</a></li>
  <li><a href="#mixed-effects-model" id="toc-mixed-effects-model" class="nav-link" data-scroll-target="#mixed-effects-model">Mixed effects model</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Fuel economy matters for consumers and environmental policy. We ask a focused question: after accounting for observable vehicle attributes, do manufacturers differ in typical city fuel economy?</p>
<p>Conceptually, we aim to separate manufacturer level differences from variation attributable to specific models. To that end, we compare manufacturers while adjusting for key covariates and explicitly distinguish manufacturers from model level effects so that inferences about brands are not confounded by the mix of models.</p>
<p>The sections that follow describe the data and filtering choices, explore salient patterns, and then fit benchmark and hierarchical models with accompanying diagnostics, before concluding with implications and limitations.</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>The data come from the mpg dataset <span class="citation" data-cites="ggplot2">(<a href="#ref-ggplot2" role="doc-biblioref">GGplot2 Development Team, n.d.</a>)</span>. We focus on front‑wheel‑drive petrol cars in the compact, midsize, and subcompact classes to keep the comparison balanced. Because models were selected based on having new releases across 1999–2008 (used as a proxy for popularity), manufacturers appear in the sample according to availability rather than a strict experimental design. This affects whether manufacturers are best treated as random or fixed effects.</p>
<p>On one hand, manufacturers could be treated as random effects because they were not experimentally selected; on the other hand, we are interested in manufacturer‑specific differences, so treating manufacturers as fixed effects would be useful if each manufacturer is well represented. After filtering the data some manufacturers are missing or sparsely represented, so the scope of inference is limited — we can test whether manufacturers differ, but precise fixed‑effect estimates for every manufacturer would be unreliable.</p>
<p>Models are treated as random and are nested inside manufacturers because the sample contains multiple models per manufacturer and the particular models present are effectively a random sample from all possible models.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 16%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">manufacturer</th>
<th style="text-align: left;">model</th>
<th style="text-align: right;">displ</th>
<th style="text-align: left;">year</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">mpg</th>
<th style="text-align: left;">fl</th>
<th style="text-align: left;">class</th>
<th style="text-align: left;">trans</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">honda</td>
<td style="text-align: left;">civic</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: left;">1999</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">25</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">subcompact</td>
<td style="text-align: left;">manual</td>
</tr>
<tr class="even">
<td style="text-align: left;">hyundai</td>
<td style="text-align: left;">sonata</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: left;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">midsize</td>
<td style="text-align: left;">auto</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hyundai</td>
<td style="text-align: left;">tiburon</td>
<td style="text-align: right;">2.7</td>
<td style="text-align: left;">2008</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">17</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">subcompact</td>
<td style="text-align: left;">manual</td>
</tr>
<tr class="even">
<td style="text-align: left;">nissan</td>
<td style="text-align: left;">altima</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: left;">2008</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">19</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">midsize</td>
<td style="text-align: left;">manual</td>
</tr>
<tr class="odd">
<td style="text-align: left;">toyota</td>
<td style="text-align: left;">camry solara</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: left;">1999</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">18</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">compact</td>
<td style="text-align: left;">auto</td>
</tr>
<tr class="even">
<td style="text-align: left;">toyota</td>
<td style="text-align: left;">camry solara</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: left;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">22</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">compact</td>
<td style="text-align: left;">auto</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nissan</td>
<td style="text-align: left;">altima</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: left;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">23</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">midsize</td>
<td style="text-align: left;">manual</td>
</tr>
<tr class="even">
<td style="text-align: left;">chevrolet</td>
<td style="text-align: left;">malibu</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: left;">1999</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">19</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">midsize</td>
<td style="text-align: left;">auto</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hyundai</td>
<td style="text-align: left;">sonata</td>
<td style="text-align: right;">3.3</td>
<td style="text-align: left;">2008</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">19</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">midsize</td>
<td style="text-align: left;">auto</td>
</tr>
<tr class="even">
<td style="text-align: left;">pontiac</td>
<td style="text-align: left;">grand prix</td>
<td style="text-align: right;">3.8</td>
<td style="text-align: left;">2008</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">18</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">midsize</td>
<td style="text-align: left;">auto</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Because of the way the data is collected, (selection of models which had a new release every year between 1999 and 2008 - this was used as a proxy for the popularity of the car), we need to be careful about how manufacturers are treated in the analysis. On one hand it seems only fair to treat manufacturers as also being random, since these were not specifically selected in the design of experiment (like car <em>model</em> these appear randomly in the data based on popularity criteria) <span class="citation" data-cites="extending_lm_with_R_book">(<a href="#ref-extending_lm_with_R_book" role="doc-biblioref">Faraway 2016</a>)</span>. On the other hand, we are interested in the actual differences between manufacturers, so treating them as fixed effects is desirable. <br> However, to warrant the use of fixed effects for manufacturers, we need to have sufficient data for each manufacturer and post filtering, the data should have all the manufacturers of interest. As can be seen this is not the case. <br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It can be seen that several key manufacturers are missing from the final dataset, consequently we may only be able to answer question like <em>Is the mpg among manufacturers significantly different ?</em> as opposed to <em>What is the average mpg of manufactuers to be able to compare them more directly</em> <br> Of course, the car models are random in the study design, so we will treat them as such. Although these are nested inside manufacturers. <br></p>
<section id="eda" class="level3">
<h3 class="anchored" data-anchor-id="eda">EDA</h3>
<p>Data summary is as follows -</p>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 24%">
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total_rows</th>
<th style="text-align: right;">total_manufacturers</th>
<th style="text-align: right;">total_models</th>
<th style="text-align: right;">min_mpg</th>
<th style="text-align: right;">max_mpg</th>
<th style="text-align: right;">mean_mpg</th>
<th style="text-align: right;">total_years</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">87</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">manufacturer</th>
<th style="text-align: left;">model</th>
<th style="text-align: right;">counts</th>
<th style="text-align: right;">mean_mpg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">18.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">chevrolet</td>
<td style="text-align: left;">malibu</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">18.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">honda</td>
<td style="text-align: left;">civic</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">24.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">hyundai</td>
<td style="text-align: left;">sonata</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">19.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hyundai</td>
<td style="text-align: left;">tiburon</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">18.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">nissan</td>
<td style="text-align: left;">altima</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">20.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nissan</td>
<td style="text-align: left;">maxima</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">18.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">pontiac</td>
<td style="text-align: left;">grand prix</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">17.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">toyota</td>
<td style="text-align: left;">camry</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">19.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">toyota</td>
<td style="text-align: left;">camry solara</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">19.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">toyota</td>
<td style="text-align: left;">corolla</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">25.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">volkswagen</td>
<td style="text-align: left;">gti</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">20.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">volkswagen</td>
<td style="text-align: left;">jetta</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">19.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">volkswagen</td>
<td style="text-align: left;">new beetle</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">20.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">volkswagen</td>
<td style="text-align: left;">passat</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">18.6</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>There are (exactly) two years of data covering 15 models. We treat year as a categorical variable rather than continuous. A short sample for one model is shown below.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">manufacturer</th>
<th style="text-align: left;">model</th>
<th style="text-align: right;">displ</th>
<th style="text-align: left;">year</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">mpg</th>
<th style="text-align: left;">fl</th>
<th style="text-align: left;">class</th>
<th style="text-align: left;">trans</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: left;">1999</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">18</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: left;">auto</td>
</tr>
<tr class="even">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: left;">1999</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: left;">manual</td>
</tr>
<tr class="odd">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">2.8</td>
<td style="text-align: left;">1999</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">16</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: left;">auto</td>
</tr>
<tr class="even">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">2.8</td>
<td style="text-align: left;">1999</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">18</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: left;">manual</td>
</tr>
<tr class="odd">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: left;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">20</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: left;">manual</td>
</tr>
<tr class="even">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: left;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: left;">auto</td>
</tr>
<tr class="odd">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: left;">2008</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">18</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: left;">auto</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We observe multiple rows per model/year because of different displacements and transmission types. The data only contain three distinct cylinder sizes (4, 6, 8), which is captured by displacement, so we remove cyl to simplify the analysis.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Fuel type (regular vs premium) is not central to this study and shows little correlation with city mpg, so we drop the fuel type column as well.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We visualize how mpg varies across manufacturers and by other attributes to get an initial sense of the patterns.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There does seem to be quite a lot variability in the city mpg among manufacturers. <br> Although, it is definitely possible that this is driven by different models and their attributes more than manufacturers themselves. <br></p>
<p>The plot below suggests (to intuition) that with larger <em>displacement</em> the <em>mpg</em> reduces. Although there is a hint of nonlinearity in the trend, we shall ignore this initially. <br> Midsize cars are slightly less efficient (lower mpg) than compact and subcompact cars. This is expected since these are heavier with higher displacement engines. <br> It is hard to get an accurate read on the effect of transmission and so we shall defer it to the model to figure out.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The mpg distribution has a right skew, so we take the logarithm of mpg to stabilize variance and to make regression coefficients interpretable as approximate percentage changes.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<section id="baseline-model" class="level3">
<h3 class="anchored" data-anchor-id="baseline-model">Baseline model</h3>
<p>We start with a simple linear model that includes manufacturer as a fixed effect along with displacement and year. This fixed‑effects model provides a baseline and helps identify which predictors explain the most variation in log(mpg). Transmission and class become less important after accounting for displacement and manufacturer, so we simplify the model accordingly.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: log(mpg)
             Df  Sum Sq Mean Sq  F value    Pr(&gt;F)    
manufacturer  7 0.66676 0.09525  25.9752 &lt; 2.2e-16 ***
displ         1 0.43577 0.43577 118.8345 &lt; 2.2e-16 ***
class         2 0.01534 0.00767   2.0922    0.1307    
trans         1 0.00590 0.00590   1.6102    0.2084    
year          1 0.13722 0.13722  37.4189 4.133e-08 ***
Residuals    74 0.27136 0.00367                       
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>It can be seen that <em>manufacturer</em> and <em>displ</em> are highly significant predictors of log(mpg). As seen in the plot earlier, 1L increase in displacement can reduce MPG by ~15% () <br> Transmission is not significant in the presence of other predictors as was the observation from plot earlier. <br> Class is not significant either, although this may be due to confounding with displacement as suspected before. A formal test of displacement being positively related with class for any given model also validates this finding. <br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: displ
          Df Sum Sq Mean Sq F value    Pr(&gt;F)    
class      2 11.759  5.8796 27.0251 1.876e-09 ***
model     13 12.390  0.9531  4.3807 2.222e-05 ***
Residuals 71 15.447  0.2176                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Consequently we can simplify the model by removing <em>trans</em> and <em>class</em>, which results in a decent fit to the data and diagnostics are satisfactory.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mixed-effects-model" class="level3">
<h3 class="anchored" data-anchor-id="mixed-effects-model">Mixed effects model</h3>
<p>Because models are nested within manufacturers and the specific models in the data are essentially a random sample, we fit mixed‑effects models that include random intercepts for manufacturer and for model nested within manufacturer. This accounts for the correlation between observations from the same model and between models from the same manufacturer.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Fixed Effects:
            coef.est coef.se
(Intercept)  3.33     0.04  
displ       -0.15     0.01  
year2008     0.08     0.01  

Random Effects:
 Groups             Name        Std.Dev.
 manufacturer:model (Intercept) 0.05    
 manufacturer       (Intercept) 0.06    
 Residual                       0.05    
---
number of obs: 87, groups: manufacturer:model, 15; manufacturer, 8
AIC = -199.6, DIC = -250.4
deviance = -231.0 </code></pre>
</div>
</div>
<p>It can be seen that variance due to manufacturer and models nested inside manufacturer are comparable in magnitudes. The variation in mpg is due to both which is sesnible outcome. <br></p>
<p>It can be tested if including model effects is meaningful using a likelihood ratio test. <span class="citation" data-cites="rlrsim">(<a href="#ref-rlrsim" role="doc-biblioref">Scheipl, Greven, and Kuechenhoff 2008</a>)</span></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    simulated finite sample distribution of RLRT.
    
    (p-value based on 10000 simulated values)

data:  
RLRT = 13.167, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>So we reject the hypothesis that manufacturer:model nesting effect is not significant. <br></p>
<p>Additionally we can check confidence intervals for variance components. Manufacturer variance intervals do not contain 0.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Computing bootstrap confidence intervals ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
105 message(s): boundary (singular) fit: see help('isSingular')
1 warning(s): Model failed to converge with max|grad| = 0.0036062 (tol = 0.002, component 1)</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">2.5 %</th>
<th style="text-align: right;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">.sig01</td>
<td style="text-align: right;">0.0057855</td>
<td style="text-align: right;">0.0733163</td>
</tr>
<tr class="even">
<td style="text-align: left;">.sig02</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.1040288</td>
</tr>
<tr class="odd">
<td style="text-align: left;">.sigma</td>
<td style="text-align: right;">0.0448014</td>
<td style="text-align: right;">0.0626391</td>
</tr>
<tr class="even">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">3.2504237</td>
<td style="text-align: right;">3.4155443</td>
</tr>
<tr class="odd">
<td style="text-align: left;">displ</td>
<td style="text-align: right;">-0.1758906</td>
<td style="text-align: right;">-0.1248191</td>
</tr>
<tr class="even">
<td style="text-align: left;">year2008</td>
<td style="text-align: right;">0.0584266</td>
<td style="text-align: right;">0.1074370</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="diagnostics" class="level4">
<h4 class="anchored" data-anchor-id="diagnostics">Diagnostics</h4>
<p>Residual diagnostics suggest approximate normality and roughly constant variance. Random‑effect Q–Q plots indicate the manufacturer:model random effects are reasonably close to normal; manufacturer effects are also approximately normal.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also check assumption of normality of random effects. Which holds up reasonably well (particularly for manufacturer:model).</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>We set out to test whether manufacturers differ in city mpg after controlling for other attributes. Accounting for model‑level clustering, year and displacement, we find remaining manufacturer‑level variation in city mpg. In other words, even after controlling for model and engine size, manufacturers differ in typical city mpg. <br></p>
<p>The variability among manufacturers is of the order of +/- 6%, which translates to +/-1.2 mpg on average <br></p>
<p>Limitations: this analysis is limited to petrol, front‑wheel‑drive cars in the compact/midsize/subcompact classes. Results should not be generalized beyond these groups without further study. Results are also sensitive to the treatment of manufacturers as random effects due to the sampling design.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-extending_lm_with_R_book" class="csl-entry" role="listitem">
Faraway, Julian J. 2016. <em>Extending the Linear Model with r, Second Edition</em>. CRC Press.
</div>
<div id="ref-ggplot2" class="csl-entry" role="listitem">
GGplot2 Development Team. n.d. <span>“The r Project for Statistical Computing.”</span> <a href="https://ggplot2.tidyverse.org/reference/mpg.html">https://ggplot2.tidyverse.org/reference/mpg.html</a>.
</div>
<div id="ref-rlrsim" class="csl-entry" role="listitem">
Scheipl, Fabian, Sonja Greven, and Helmut Kuechenhoff. 2008. <span>“Size and Power of Tests for a Zero Random Effect Variance or Polynomial Regression in Additive and Linear Mixed Models.”</span> <em>Computational Statistics &amp; Data Analysis</em> 52 (7): 3283–99.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>