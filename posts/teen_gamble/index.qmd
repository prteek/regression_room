---
title: "Teen gambling"
author: "Prateek"
date: "2025-10-16"
categories: [regression, ANOVA]
image: "gambling.jpeg"
toc: true
bibliography: references.bib
description: Analysis of factors affecting teen gambling using regression and ANOVA
---

```{r}
#| warning: false
#| echo: false
library(this.path)
setwd(here())
renv::load()

library(knitr)
library(tidyverse)
library(DBI)
library(RAthena)
library(patchwork)
library(glue)
library(tidymodels)
library(mgcv)
library(faraway)
tidymodels_prefer()
theme_set(theme_minimal())
acon <- dbConnect(
  athena(),
  workgroup = "primary",
  schema_name = "default",
  s3_staging_dir = "s3://aws-athena-query-results-434616802091-eu-west-1",
  profile_name = "personal",
  region = "eu-west-1",
)
athena_sql <- function(query) {
  tibble(dbGetQuery(acon, query))
}

options(width = 400)

```

## Introduction
This analysis examines factors influencing teenage gambling expenditure. We explore the relationships between annual expenditure, gender, and weekly income. Our hypothesis is that both gender and income affect teenagers' gambling expenditure. <br/>

## Data
The analysis uses data from [@gambling_in_young_adolescents], a survey of teenage gambling behaviour in Britain. <br/>

The key variables are:

- sex
- status : Socioeconomic status score based on parents' occupation
- income : Weekly income in pounds
- verbal : Verbal score (number of words defined correctly, out of 12)
- gamble : Annual expenditure on gambling in pounds

```{r}
#| warning: false
#| cache: true
#| echo: false

teengamb <- faraway::teengamb %>%
  mutate(sex = if_else(sex == 0, 'male', 'female'))

teengamb %>% head() %>% kable()

```

A cursory look at the data suggests that females likely spend less on gambling compared to males. Additionally, most females do not spend more than approximately £20 per year on gambling.

```{r}
#| echo: false

teengamb %>%
  ggplot(aes(gamble)) +
  geom_density(aes(colour = sex)) +
  labs(
    x = "Expenditure on gambling (pounds per year)",
    y = "Density"
  )

```

There also seems positive association between income and amount spent on gambling (at least for males). This is not very surprising as one would expect that individuals with higher income would be able to spend more on gambling. <br/>
 From what this plot indicates, it may be worth evaluating if there is a differential effect of income based on gender.

```{r}
#| echo: false

p1 <- teengamb %>%
  ggplot(aes(income, gamble)) +
  geom_point(aes(colour = sex)) +
  labs(
    x = "Income (pounds per week)",
    y = "Expenditure on gambling (pounds per year)"
  )

p2 <- teengamb %>%
  ggplot(aes(sex, gamble)) +
  geom_boxplot() +
  labs(
    x = "Sex",
    y = "Expenditure on gambling (pounds per year)"
  )

p1 + p2

```

## Analysis

The response variable gamble is non‑negative and strongly right‑skewed. We therefore model log(gamble + 1). Adding £1 ensures the log is defined for zero spenders, keeps small expenditures near zero on the transformed scale, and avoids introducing artificial extreme negative values. Note this is different from a GLM with a log link: here we model the (logged) response directly, which changes how effects are interpreted on the original scale. <br/>

Observation 24 (gamble = £156) appears to be an outlier and is removed from the analysis.

### Effect of Gender

It seems plausible that males are spending more on gambling compared to females. This is also indicated by the boxplot below. We will evaluate this hypothesis using a simple linear model with *log(gamble + 1)* as response and *sex* as explanatory variable.

```{r}
#| echo: false
teengamb <- teengamb %>%
  as_tibble() %>%
  filter(gamble < 150) %>%
  mutate(
    log_gamble = log(gamble + 1),
    sex = factor(sex)
  )

ggplot(teengamb, aes(sex, log_gamble)) +
  geom_boxplot() +
  labs(
    x = "Sex",
    y = "Log(Expenditure on gambling + 1)"
  )

gender_model <- lm(log_gamble ~ sex, data = teengamb)
print(anova(gender_model))

```

**Gender seems to have statistically significant association with gambling expenditure**. <br/>
Anova procedure is equivalent to a t-test with constant variance assumption [@lm_with_R_book], which seems fair from the Boxplot above. They test for the same effect and result in identical p-values. <br/>

Before moving to analysing joint effect of Income and Gender, it is imperative to check if the effect of gender is not due to confounding by income. It could well be the case that individuals with higher income spend more on gambling. But then if high income itself is associated with gender, then the above effect of gender may be spurious. We will explore this next.

```{r}
#| echo: false

ggplot(teengamb, aes(sex, income)) +
  geom_boxplot() +
  labs(
    x = "Sex",
    y = "Income (pounds per week)"
  )

income_model <- lm(income ~ sex, data = teengamb)
print(anova(income_model))

```

The above plot and the test indicates that income is not significantly associated with gender and hence does not mask its effect on gambling expenditure. <br/>

For the analysis that follows, we shall print the summary of gender only model to show the Estimate value and Std. Error of gender.

```{r}
summary(gender_model)

```

### Effect of Gender and Income

With *income* variable included alongside *sex*, the effect of *sex* remains significant (although is reduced from 1.35 to 1.24 with lower Std. Error). <br/>
Income itself is significantly associated with gambling expenditure. <br/>
The intercept is non-significant indicating that for reference class (female), gambling expenditure is likely 0£ if they have close to 0 income and it makes intuitive sense (although for adults and addicts this may not necessarily be true). <br/>
This model does not include an interaction between *sex* and *income* for simplicity, yet it fits the data well. Model diagnostics appear acceptable. <br/>

```{r}
#| echo: false

income_sex_no_interaction <- lm(
  log_gamble ~ sex + income,
  data = teengamb
)

income_sex_no_interaction %>% summary()

par(mfrow = c(2, 2))
plot(income_sex_no_interaction)
par(mfrow = c(1, 1))

```

Additionally, the residuals do not indicate any obvious pattern with respect to gender.

```{r}
#| echo: false

teengamb <- teengamb %>%
  mutate(
    .fitted = predict(income_sex_no_interaction, .),
    resid = log_gamble - .fitted
  )

teengamb %>%
  ggplot(aes(.fitted, resid)) +
  geom_point(aes(colour = sex)) +
  geom_abline(slope = 0, intercept = 0, alpha = 0.2, linetype = 'dashed') +
  labs(
    x = "Fitted values",
    y = "Residuals"
  )

```

From earlier plots we suspected a possible differential effect of income by gender. Fitting an interaction did not improve fit and the interaction term is not significant, so the simpler additive model is preferred.

```{r}
#| echo: false

income_sex_interaction <- lm(
  log_gamble ~ sex * income,
  data = teengamb
)

print(anova(income_sex_interaction, income_sex_no_interaction))

```

Additionally, interaction term is not significant and so it is best to remove it and keep the model simple. <br/>

```{r}
#| echo: false

print(income_sex_interaction %>% summary())

```

## Conclusion
Both gender and income are significantly associated with teenage gambling expenditure. Males spend about three times more than females on average (note: reporting biases could inflate this effect; boys may over-report and girls may under-report [@gambling_in_young_adolescents]). A £1 increase in weekly income is associated with an approximate 19% increase in annual gambling expenditure on the log scale interpretation. The interaction between gender and income was not significant, suggesting the effect of income is similar across genders. <br/>
