---
title: "Teen gambling analysis"
author: "Prateek"
date: "2025-10-16"
categories: [regression, ANOVA]
image: "gambling.jpeg"
toc: true
bibliography: references.bib
description: Analysis of factors affecting teen gambling using regression and ANOVA
---

```{r}
#| warning: false
#| echo: false
library(this.path)
setwd(here())
renv::load()

library(knitr)
library(tidyverse)
library(DBI)
library(RAthena)
library(patchwork)
library(glue)
library(tidymodels)
library(mgcv)
library(faraway)
tidymodels_prefer()
theme_set(theme_minimal())
acon <- dbConnect(
  athena(),
  workgroup = "primary",
  schema_name = "default",
  s3_staging_dir = "s3://aws-athena-query-results-434616802091-eu-west-1",
  profile_name = "personal",
  region = "eu-west-1",
)
athena_sql <- function(query) {
  tibble(dbGetQuery(acon, query))
}

options(width = 400)

```

## Introduction
This analysis aims to understand the factors that influence teenage gambling expenditure. We will explore the relationships between gambling expenditure and gender and income. It is our hypothesis that both gender and income should affect gambling expenditure among teenagers. <br/>


## Data
The analysis is based on data from [@gambling_in_young_adolescents] published in the Journal of Gambling Behavior. It comes from a survey that was conducted to study teenage gambling in Britain. <br/>

The key variables are:

- sex
- status : Socioeconomic status score based on parents' occupation
- income : Weekly income in pounds
- verbal : verbal score in words out of 12 correctly defined
- gamble : expenditure on gambling in pounds per year

```{r}
#| warning: false
#| cache: true
#| echo: false

teengamb <- faraway::teengamb %>%
  mutate(sex = if_else(sex == 0, 'male', 'female'))

teengamb %>% head() %>% kable()

```

A cursory look at the data suggests that females likely spend less on gambling compared to males. Additionally that most females do not spend more than approx. 20£ per year on gambling.

```{r}
#| echo: false

teengamb %>%
  ggplot(aes(gamble)) +
  geom_density(aes(colour = sex)) +
  labs(
    x = "Expenditure on gambling (pounds per year)",
    y = "Density"
  )

```

There also seems positive association between income and amount spent on gambling (at least for males). This is not very surprising as one would expect that individuals with higher income would be able to spend more on gambling. <br/>
 From what this plot indicates, it may be worth evaluating if there is a differential effect of income based on gender.

```{r}
#| echo: false

p1 <- teengamb %>%
  ggplot(aes(income, gamble)) +
  geom_point(aes(colour = sex)) +
  labs(
    x = "Income (pounds per week)",
    y = "Expenditure on gambling (pounds per year)"
  )

p2 <- teengamb %>%
  ggplot(aes(sex, gamble)) +
  geom_boxplot() +
  labs(
    x = "Sex",
    y = "Expenditure on gambling (pounds per year)"
  )

p1 + p2

```

## Analysis

Our variable of interest gamble is  strictly positive and continuous with a long tail. We consider taking log of gamble value. This alters the interpretation of model mechanics but it remains sensible, e.g. males spend x% more than females or 1£ increase in income leads to y% increase in expenditure in gambling. <br/>
Side note: This is different from using GLM with Gaussian family and log link. Because in original scale, variance is non constant and multiplicative effects are expected on original scale of response (as opposed to expected value of response). <br/>

To be able to take logarithms of cases where 0£ are spent on gambling, 1£ is added to gambling spent for all cases. This value is chosen to ensure 0 for cases where 0£ are spent and values close to 0 for small spends, additionally this does not introduce un necessary -ve outlier values resulting in better fit. <br/>

Individual *24* seems to have spent 156£ on gambling and likely seems an outlier. This seems to be outside the usual range of expenditure and will not inform the study in a general sense. Hence, we remove this point from the analysis.

### Effect of Gender

It seems plausible that males are spending more on gambling compared to females. This is also indicated by the boxplot below. We will evaluate this hypothesis using a simple linear model with *log(gamble + 1)* as response and *sex* as explanatory variable.

```{r}
#| echo: false
teengamb <- teengamb %>%
  as_tibble() %>%
  filter(gamble < 150) %>%
  mutate(
    log_gamble = log(gamble + 1),
    sex = factor(sex)
  )

ggplot(teengamb, aes(sex, log_gamble)) +
  geom_boxplot() +
  labs(
    x = "Sex",
    y = "Log(Expenditure on gambling + 1)"
  )

gender_model <- lm(log_gamble ~ sex, data = teengamb)
print(anova(gender_model))

```

**Gender seems to have statistically significant association with gambling expenditure**. <br/>
Anova procedure is equivalent to a t-test with constant variance assumption [@lm_with_R_book], which seems fair from the Boxplot above. They test for the same effect and result in identical p-values. <br/>

Before moving to analysing joint effect of Income and Gender, it is imperative to check if the effect of gender is not due to confounding by income. It could well be the case that individuals with higher income spend more on gambling. But then if high income itself is associated with gender, then the above effect of gender may be spurious. We will explore this next.

```{r}
#| echo: false

ggplot(teengamb, aes(sex, income)) +
  geom_boxplot() +
  labs(
    x = "Sex",
    y = "Income (pounds per week)"
  )

income_model <- lm(income ~ sex, data = teengamb)
print(anova(income_model))

```

The above plot and the test indicates that income is not significantly associated with gender and hence does not mask its effect on gambling expenditure. <br/>

For the analysis that follows, we shall print the summary of gender only model to show the Estimate value and Std. Error of gender.

```{r}
summary(gender_model)

```

### Effect of Gender and Income

With *income* variable included alongside *sex*, the effect of *sex* remains significant (although is reduced from 1.35 to 1.24 with lower Std. Error). <br/>
Income itself is significantly associated with gambling expenditure. <br/>
The intercept is non-significant indicating that for reference class (female), gambling expenditure is likely 0£ if they have close to 0 income and it makes intuitive sense (although for adults and addicts this may not necessarily be true). <br/>
This model does not include an interaction between *sex* and *income* for simplificty, yet fits the data well. Model diagnostics also appear acceptable. <br/>

```{r}
#| echo: false

income_sex_no_interaction <- lm(
  log_gamble ~ sex + income,
  data = teengamb
)

income_sex_no_interaction %>% summary()

par(mfrow = c(2, 2))
plot(income_sex_no_interaction)
par(mfrow = c(1, 1))

```

Additionally, the residuals do not indicate any obvious pattern with respect to gender.

```{r}
#| echo: false

teengamb <- teengamb %>%
  mutate(
    .fitted = predict(income_sex_no_interaction, .),
    resid = log_gamble - .fitted
  )

teengamb %>%
  ggplot(aes(.fitted, resid)) +
  geom_point(aes(colour = sex)) +
  geom_abline(slope = 0, intercept = 0, alpha = 0.2, linetype = 'dashed') +
  labs(
    x = "Fitted values",
    y = "Residuals"
  )

```

From an earlier observation, it was suspected that there could be differential effect of income on expenditure based on gender. The current model (lines) seems to indicate that there might be some difference between how males and females respond to changes in income. <br/>

```{r}
#| echo: false

ggplot(teengamb, aes(x = income, colour = sex)) +
  geom_point(aes(y = log_gamble)) +
  geom_line(aes(y = .fitted))

```

We shall try to fit an interaction between *sex* and *income* to evaluate if this is indeed the case. <br/>

It appears as though the interaction does not improve the model fit compared to no interaction model. <br/>

```{r}
#| echo: false

income_sex_interaction <- lm(
  log_gamble ~ sex * income,
  data = teengamb
)

print(anova(income_sex_interaction, income_sex_no_interaction))

```

Additionally, interaction term is not significant and so it is best to remove it and keep the model simple. <br/>

```{r}
#| echo: false

print(income_sex_interaction %>% summary())

```

## Conclusion
The analysis indicates that both gender and income are significantly associated with gambling expenditure among teenagers. <br/>
Males tend to spend 3x more than females on gambling (even at comparable income levels). This effect may be inflated to some degree since boys tended to exaggerate their gambling spend and girls tended to under-report them [@gambling_in_young_adolescents]. <br/>
A 1£ increase in weekly income is associated with a 19% increase in annual gambling expenditure. <br/>
The interaction between gender and income was not significant, indicating that the effect of income on gambling expenditure is similar for both genders. <br/>
